---
layout: single
title : 다중 서버 환경에서 session 불일치 문제와 해결 방법
excerpt : ""
---

사용자가 로그인하기 위해 POST 요청을 보내면 서버는 이 요청을 받고 session id를 발급한다. 그리고 session id를 응답 객체에 실어 사용자에게 재전송하고 사용자는 브라우저의
쿠키 저장소에 session id를 저장해 상태를 유지할 수 있다.

![img](/assets/images/session.png)

위 그림처럼 단일 서버 환경에서는 session을 통한 로그인을 구현할 때 session 불일치 문제를 신경쓸 필요가 없다. 
하지만 서비스가 커짐에 따라 한 대의 서버로 운영하는 것이 불가능해질 경우 서버를 업그레이드 해야하는데 다음과 같은 두 가지 방식이 존재한다.

첫 번째 방법은 **scale-up** 방식이다. **서버 자체의 성능을 늘려** 트래픽을 견딜 수 있게 하는 방식이지만, 여전히 서버 한 대에 모든 트래픽이 집중될 가능성이 있으므로 만일 서버 장애가 생길 시 서버가 복구될 때까지
서비스를 중단해야 하는 상황이 발생할 수 있다.

두 번째 방법은 **scale-out** 방식이다. **서버를 여러대로 늘려**서 각 서버에 로드밸런싱으로 트래픽을 분산하게 한다. 그래서 서버 한 대에 장애가 생겨도 다른 서버에 영향을 주지 않는다.
그러나 이 때 데이터 정합성, **세션 불일치 문제**가 발생할 수 있다. 왜냐하면 여러 대의 서버가 각각 세션 저장소를 독립적으로 갖기 때문에 데이터 불일치가 발생하기 때문이다.

![img2](/assets/images/session2.png)

사용자는 로그인 하기 위해 서버2와 통신한다. 서버1과 서버3은 session id를 가지고 있지 않다.
만약 사용자가 서버1이나 서버3에 요청을 보낼 경우 일치하는 session id가 없기 때문에 상태를 유지할 수 없고 로그인이 풀리게 된다.
